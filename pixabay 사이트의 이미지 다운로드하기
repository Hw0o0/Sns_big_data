from selenium import webdriver
import time
import os
import requests

#keyword = input("크롤링할 이미지의 키워드는 무엇입니까?:")
keyword = "고양이"

#cnt = int(input("크롤링 할 건수는 몇건입니까?:"))
cnt = 15

f_dir = "C:\\Users\\UIT801-\\Desktop\\웹크롤링\\"
query_txt = "사진저장"
folder_path = f_dir + "\\" + query_txt

if not os.path.exists(folder_path):
    os.makedirs(folder_path)
    os.chdir(folder_path)

path = "c:/temp/chromedriver_240/chromedriver.exe"
driver = webdriver.Chrome(path)

driver.get("https://pixabay.com/ko/images/search/")
time.sleep(1)

search_bar = driver.find_element(By.NAME, 'search')
search_bar.send_keys(keyword)
search_bar.submit()
time.sleep(1)

file_no = 1
count = 1

while count <= cnt:
    driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
    time.sleep(1)

    images = driver.find_elements(By.TAG_NAME, 'img')

    for i in range(len(images)):
        if count > cnt:
            break

        image_src = images[i].get_attribute('src')
        if '.jpg' in image_src:
            response = requests.get(image_src)
            with open(os.path.join(folder_path, f'{count}.jpg'), 'wb') as f:
                f.write(response.content)
            count += 1

    try:
        next_button = driver.find_element(By.CLASS_NAME, 'buttonBase--r4opq secondaryButton--xk9cO base--jzyee light--uBcBI')
        next_button.click()
        time.sleep(1)
    except:
        break

driver.quit()
